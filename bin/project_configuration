#!/usr/bin/env python
# -*- coding: utf-8 -*-

import os
import sys
import yaml
import argparse

MAIN_CONFIG_FILE = 'main.yaml'

def find_config_file():
    config_dir = os.environ.get('PROJECT_DIR')
    if config_dir:
        return os.path.join(config_dir, MAIN_CONFIG_FILE)
    else:
        raise Exception
        #return os.path.expanduser(os.path.join('~', '.' + MAIN_CONFIG_FILE))

def format_config(config, format_type):
    if format_type == 'shell':
        return ' '.join('"{}"'.format(item) for item in config)
    return config

def dotted_path(config, key):
    parts = key.split('.')
    value = config
    for part in parts:
        if isinstance(value, list):
            part = int(part)
        value = value[part]
    return value

def get_config():
    config_file = find_config_file()
    config = yaml.load(open(config_file))
    return config

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--key', required=True)
    parser.add_argument('--value')
    parser.add_argument('--format', default='yaml')

    config = parser.parse_args(sys.argv[1:])
    try:
        if config.value:
            pass
        else:
            conf = get_config()
            print(format_config(dotted_path(conf, config.key), config.format))
    except :
        raise
        sys.exit(1)

if __name__ == "__main__":
    main()
