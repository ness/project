#!/usr/bin/env bash

do_dirs () {
	cd $PROJECT_DIR/..
	"$@"
}

do_key () {
	echo key: $1
	shift
	echo $@

    project_configuration iter --key source_dirs --format null | parallel -0 --no-notice -k 'path={}; echo -e -n "\e[0;32m"; echo {}; echo -e -n "\e[0m"; pushd ${path/#\~/$HOME} > /dev/null && ' $@ ' && popd > /dev/null;'
}

case "$1" in
	--key)
		shift
		key=$1
		shift
		do_key $key $@
		;;
	*)
		do_dirs $@
		;;
esac
